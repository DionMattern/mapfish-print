name: summon

on:
  push:
  schedule:
    - cron:  '0 0 * * *'

jobs:
  build:
    runs-on: ubuntu-18.04
    name: summon
#    env:
#      PATH: /home/runner/.linuxbrew/bin:/usr/local/bin:/usr/bin:/bin
    steps:
      - run: echo $HOME
      - run: pwd
      - run: id
      - run: wget -q -O- https://api.bintray.com/orgs/gopasspw/keys/gpg/public.key | sudo apt-key add -
      - run: echo "deb https://dl.bintray.com/gopasspw/gopass trusty main" | sudo tee /etc/apt/sources.list.d/gopass.list
      - run: sudo apt update
      - run: sudo apt install --yes linuxbrew-wrapper gopass build-essential
      - run: sudo chmod o+w /usr/local/bin/
      - run:
          curl --show-error --silent --location
          https://github.com/cyberark/summon/releases/download/v${SUMMON_VERSION}/summon-linux-amd64.tar.gz
          -o - | tar xz summon -O > /usr/local/bin/summon &&
          chmod +x /usr/local/bin/summon
      - run: gopass init --store gs/ci
      - run: gopass git remote add --store gs/ci origin git@github.com:camptocamp/geospatial-ci-pass.git
      - run: summon -p gopass
